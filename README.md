"# StaticLibrary" 


Hi, This is the instruction of StaticLibrary 


1. Commit .h and .cpp files , include .vcxproj and .vcxproj.filters are required.

2. the project must can be run successfully in Visual Studio 2017, then it can compile and built in Virtual Machine, like appveyor.  Since We need to upload the .vcxproj files, which is generated by Visual Studio 


TrouthShooting : 

1. C:\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140\Microsoft.Cpp.Platform.targets(57,5): error MSB8020: The build tools for v141 (Platform Toolset = 'v141') cannot be found. To build using the v141 build tools, please install v141 build tools.  Alternatively, you may upgrade to the current Visual Studio tools by selecting the Project menu or right-click the solution, and then selecting "Retarget solution". [c:\projects\myproject\MathFuncsLib\MathFuncsLib.vcxproj]


Answer: .vcxproj file is not match  !  

2. Test: Compile the code again using VS 2015 in Appveyor, to see whether it is build successful  !  

It does not work ! The reason is that the current .vcxproj file is generated by Visual studio 2017 !  
 C:\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140\Microsoft.Cpp.Platform.targets(57,5): error MSB8020: The build tools for v141 (Platform Toolset = 'v141') cannot be found. To build using the v141 build tools, please install v141 build tools.  Alternatively, you may upgrade to the current Visual Studio tools by selecting the Project menu or right-click the solution, and then selecting "Retarget solution". [c:\projects\myproject\MathFuncsLib.vcxproj]


 3. Test: I compile my code locally in Visual Studio 2017 , Debug, X86.  When I compile the code using appveyor, choose Debug, X64, it can successfully built. 
 So the platform do not matter !  


We already build the boost lib in local computer, we do need to link it to Visual studio in local. 

For appveyor, there is a built finished boost library, we need to use enviroment variables to connect it with Visual Studio both in appveyor.  


Attempt : 
4. swith X86 to X64 , then you know whether boost library is missing or not ! ! 


4. we must have sln file on appveyor

5. vcxproj files determines from  which files get compiled ! 




6. Most Important : 
   make sure the enviroment setting are same for both Visual Studio and appveyor : 


   For example :  

In appveyor : 
   environment:
  BOOST_ROOT: C:\Libraries\boost_1_64_0
  BOOST_LIBRARYDIR: C:\Libraries\boost_1_64_0\lib64-msvc-14.1


In Visual Studio : 


Project-> Properties-> C/C++ ->General -> Additional Include Directories : C:\Libraries\boost_1_64_0    

Project-> Properties->Linker -> Additional Library Dependencies :  C:\Libraries\boost_1_64_0\lib64-msvc-14.1



Jan 1, 2019 
Sum up: 

 1. We do not need to upload the Debug\ folder to appveyor. 
 2. The File we only need.   .sln is the solution , .cpp file,  The .vcxproj project file, .vcxproj.filters file. and .h and .cpp files built the lib.   

 3. The enviroment should match between Visual Studio and Appveyor. such as C:\Libraries\boost_1_64_0 
  otherwise, we can set the enviroment variables. 
Task: 
  4. WE need to see the test are run in Appveyor 
  5. Use a complicated example to call boost !  





  Things I try : 
   1. Build in X86 , Release in VS 2017 in local computer, to check whether it is still working ! 
(currently only link to C:\Libraries\boost_1_64_0;) NOT library, well this try means nothing since we do not call library.  This is 1.0.94 version of StaticLibrary . IT is working.  But it do not say much !


   2. 


   Jan 3, 2019  

   Ref: code can call boost test lib
   https://www.bogotobogo.com/cplusplus/Boost/boost_AsynchIO_asio_tcpip_socket_server_client_timer_A.php

     So far we can successfully built the project on the appveyor.   
Task: 
    1. Run the test on Appveyor 
    2. run a complicated test call boost library on Appveyor !  
Procedure: 
 1) I add sync_time.cpp file , 

 1>LINK : fatal error LNK1104: cannot open file 'libboost_system-vc141-mt-x32-1_68.lib'  

 Now I copy this libboost_system-vc141-mt-x32-1_68.lib'  to the folder "C:\Libraries\boost_1_64_0\lib64-msvc-14.1".
 Current platform in VS 2017 is Release x86.  


Then : 
1>LINK : fatal error LNK1104: cannot open file 'libboost_regex-vc141-mt-x32-1_68.lib'


1>LINK : fatal error LNK1104: cannot open file 'libboost_date-time-vc141-mt-x32-1_68.lib'


Now I switch to platform Release x64, 
it has error : 
1>------ Build started: Project: MyExecRefsLib, Configuration: Release x64 ------
1>LINK : fatal error LNK1104: cannot open file 'libboost_system-vc141-mt-x64-1_68.lib'
1>Done building project "MyExecRefsLib.vcxproj" -- FAILED.


Conclusion 1:  different platform (Debug/Release, x86/x64) need different version of boost lib !  

Double check : 
when set the platform : "Debug x64 "
2>LINK : fatal error LNK1104: cannot open file 'libboost_system-vc141-mt-gd-x64-1_68.lib'


When set the platform :: "Debg x86"
1>LINK : fatal error LNK1104: cannot open file 'libboost_system-vc141-mt-gd-x32-1_68.lib'


Conclusion 2: Our boost library complete is for various platforms , 
Debug/Release , x86/x64  !  

platform vesion and boost version should match ! 

Ref:   https://www.codeproject.com/Articles/1084565/%2FArticles%2F1084565%2FCplusplus-Continuous-Integration-Setup

os: Visual Studio 2015

# Boost is already installed on AppVeyor.
environment:
  BOOST_ROOT: C:\Libraries\boost_1_59_0
  BOOST_LIBRARYDIR: C:\Libraries\boost_1_59_0\lib64-msvc-14.0
(so we believe this folder is for release version, x64)
build_script:
  - md build
  - cd build
  - cmake -G "Visual Studio 14 2015 Win64" ..
  - cmake --build . --config Release
  - ctest


  We update it to   (Release , x64)

  environment:
  BOOST_ROOT: C:\Libraries\boost_1_64_0
  BOOST_LIBRARYDIR: C:\Libraries\boost_1_64_0\lib64-msvc-14.1

Ref: https://www.appveyor.com/docs/windows-images-software/#boost

Shows boost_1_64_0 is feasible to Visual Studio 2017!  

Currently github version of built is Relase, x64 !  

On version 1.0.105, we delete the 
BOOST_ROOT: C:\Libraries\boost_1_64_0
 (Del) BOOST_LIBRARYDIR: C:\Libraries\boost_1_64_0\lib64-msvc-14.1
But it is still can built success ? 
The answer is yes ! 

How about delete 
 BOOST_ROOT: C:\Libraries\boost_1_64_0 in enviroment settings? 

 The answer is yes !  

 So the library path is identical between our computer and 
 appveyor ! 

Now: I want to try whether Release , x86 works or not in appveyor ? in the same setting that linker links to 
C:\Libraries\boost_1_64_0\lib64-msvc-14.1   . 

The answer is NO. Since the setting in appveyor is x64. 

WHen I update setting in appveyor is x86, and change the boost lib name to lib32-msvc-14.1 , things get worked.  



Question: how to make this more intelligent ? 

Use Enviroment variable !  Boost_1_64_0 can be Boost, and 
stage_86/lib can be another name !   


Again, without any enviroment setting, the both platform and boost lib must be identical to build successful !  



After talk at 12:26PM  : 

1. Switch Release and Debug, the apprevey can run automatically using the shared memory, .cpp and .vcxproj. 

https://ci.appveyor.com/project/XiaoyaoMa/staticlibrary  
Version : 1.0.119  
vcxproj file does not contain the info of (platform info : release, debug, x86, x64), it contains the info from linker ! 

Now, it shows Debug version on Appveyor is OK.  

Now switch to Release version. 
it is also working 1.0.120  version.  

The conclusion is that both libboost-xxx for release and debug version are located in lib64-msvc-14.1 folder.  




2. I have two things to check. .vcxproj files only contains info of cpp and linker, not the platform info . 
Goal is one CPP and .vcxproj file, make appreyor works both 32 and 64. Note .vcxproj files contains the library location info. 
If I make a copy of lib64-msvc-14.1 to lib32-msvc-14.1 , it works on x86 in local and appveyor ,but I need to update the 
linker, this leads the changes of .vcxproj file.  

Ref: Set enviroment variables !  
https://stackoverflow.com/questions/100543/how-do-i-set-specific-environment-variables-when-debugging-in-visual-studio  


https://docs.microsoft.com/en-us/visualstudio/msbuild/how-to-use-environment-variables-in-a-build?view=vs-2017

<BOOST_ROOT Condition="'$(BOOST_ROOT)' == ''">C:\Libraries\boost_1_59_0
</BOOST_ROOT>


*********************************

Set up the System environment variables: 
Search "env " then -> edit system enviroment variables: 
Enviroment variables-> Edit System variables 


ADD: 
BOOST_ROOT: C:\Libraries\boost_1_64_0
BOOST_LIBRARYDIR: C:\Libraries\boost_1_64_0\lib64-msvc-14.1

Then in the project : properties 
  C/C++  :  $(BOOST_ROOT)
  LINKER: $(BOOST_LIBRARYDIR) 


  Clearly, in 1.0.121  , if we do not set the corresponding 
  enviroment variables in appveyor, it is not working. 
  Now I set the enviroment variables in appveyor. 

  1.0.128  version in appveyor is working. the setting is Release 64. 

  Now I change the setting to Debug x64, the environment variable keep the same. to See 1.0.129 is working !


  Now I change the setting to Release x86, and updating the 
 BOOST_LIBRARYDIR: C:\Libraries\boost_1_64_0\lib32-msvc-14.1

To see whether it is working ,  
NO, it is not working. 
c:\projects\myproject\Release\MyExecRefsLib.exe : fatal error LNK1120: 2 unresolved externals [c:\projects\myproject\MyExecRefsLib\MyExecRefsLib.vcxproj]

Now I do an update !  


Big discovery : .vcxproj does contain the platform info , it remember in each configuration (Debug/Release, Win32/Win64), 
where is the BOOST, and BOOST_library !  
****************
'$(Configuration)|$(Platform)'=='Release|Win32'">
    <ClCompile>
      <PrecompiledHeader>
      </PrecompiledHeader>
      <WarningLevel>Level3</WarningLevel>
      <Optimization>MaxSpeed</Optimization>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>WIN32;NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <AdditionalIncludeDirectories>C:\Libraries\boost_1_64_0;%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <AdditionalLibraryDirectories>C:\Libraries\boost_1_64_0\lib64-msvc-14.1;%(AdditionalLibraryDirectories)</AdditionalLibraryDirectories>
    </Link>
  </ItemDefinitionGroup>
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <PrecompiledHeader>
      </PrecompiledHeader>
      <WarningLevel>Level3</WarningLevel>
      <Optimization>MaxSpeed</Optimization>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <SDLCheck>true</SDLCheck>
      <PreprocessorDefinitions>NDEBUG;_CONSOLE;%(PreprocessorDefinitions)</PreprocessorDefinitions>
      <ConformanceMode>true</ConformanceMode>
      <AdditionalIncludeDirectories>$(BOOST_ROOT);%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>
    </ClCompile>
    <Link>
      <SubSystem>Console</SubSystem>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <OptimizeReferences>true</OptimizeReferences>
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <AdditionalLibraryDirectories>$(BOOST_LIBRARYDIR);%(AdditionalLibraryDirectories)</AdditionalLibraryDirectories>



*******************



Now I finish all the built in Local for 4 platforms, by setting enviroment variables $(BOOST_ROOT) and $(BOOST_LIBRARYDIR) to the C/C++ and Linker.  ! 

.vcxproj must have 4 set of platform info , then we make sure
on the appveyor, 4 platform is feasible !  
Now We do a final check : 
In appveyor 
https://ci.appveyor.com/project/XiaoyaoMa/staticlibrary

BOOST_ROOT: C:\Libraries\boost_1_64_0
BOOST_LIBRARYDIR: C:\Libraries\boost_1_64_0\lib32-msvc-14.1

Debug x86  (Built success! 1.0.133)
Release x86 (Built success !1.0.134)


Jan 4. Now I switch back to boosttest_linkedlist.cpp



Jan6 : Now I want to built the lib of MathFuncsLib first, then boostTest_LinkedList.cpp call this library directly without rebuild it again.  




BOOST_ROOT: C:\Libraries\boost_1_64_0
BOOST_LIBRARYDIR: C:\Libraries\boost_1_64_0\lib64-msvc-14.1

Debug x64 (Build success : 1.0.135)
Release x64  (Build success: 1.0.136 )


D












